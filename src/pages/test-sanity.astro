---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { client } from '../sanity/lib/client';

// Mark this page as prerendered (static)
export const prerender = true;

let connectionStatus = 'Unknown';
let projectInfo = {};
let error = null;

try {
  // Test the connection by fetching project info
  const query = `*[_id == "system.info"][0]`;
  const result = await client.fetch(query);
  
  connectionStatus = 'Connected';
  projectInfo = {
    projectId: import.meta.env.PUBLIC_SANITY_PROJECT_ID,
    dataset: import.meta.env.PUBLIC_SANITY_DATASET,
    studioPath: import.meta.env.PUBLIC_SANITY_STUDIO_BASEPATH,
  };
} catch (e) {
  connectionStatus = 'Error';
  error = e.message;
}
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <BaseHead title="Sanity Connection Test" description="Testing Sanity CMS connection" />
  </head>
  <body>
    <Header />
    <main class="min-h-screen bg-slate-900 pt-20">
      <div class="container mx-auto px-4 py-12">
        <h1 class="text-4xl font-bold text-white mb-8">Sanity Connection Test</h1>
        
        <div class="card-glass mb-8">
          <h2 class="text-2xl font-semibold text-white mb-4">Connection Status</h2>
          <div class="flex items-center gap-2">
            <div class={`w-4 h-4 rounded-full ${connectionStatus === 'Connected' ? 'bg-emerald-500' : 'bg-red-500'}`}></div>
            <span class={`text-lg ${connectionStatus === 'Connected' ? 'text-emerald-400' : 'text-red-400'}`}>
              {connectionStatus}
            </span>
          </div>
          {error && (
            <p class="text-red-400 mt-2">Error: {error}</p>
          )}
        </div>

        <div class="card-glass mb-8">
          <h2 class="text-2xl font-semibold text-white mb-4">Configuration</h2>
          <dl class="space-y-2">
            <div>
              <dt class="text-slate-400">Project ID:</dt>
              <dd class="text-white font-mono">{projectInfo.projectId || 'Not set'}</dd>
            </div>
            <div>
              <dt class="text-slate-400">Dataset:</dt>
              <dd class="text-white font-mono">{projectInfo.dataset || 'Not set'}</dd>
            </div>
            <div>
              <dt class="text-slate-400">Studio Path:</dt>
              <dd class="text-white font-mono">{projectInfo.studioPath || 'Not set'}</dd>
            </div>
          </dl>
        </div>

        <div class="card-glass">
          <h2 class="text-2xl font-semibold text-white mb-4">Next Steps</h2>
          <ol class="list-decimal list-inside space-y-2 text-slate-300">
            <li>Visit <a href="/studio" class="text-emerald-400 hover:text-emerald-300">Sanity Studio</a> to add content</li>
            <li>Create your first blog post in the Studio</li>
            <li>Update the blog pages to fetch from Sanity</li>
          </ol>
        </div>
      </div>
    </main>
    <Footer />
  </body>
</html>