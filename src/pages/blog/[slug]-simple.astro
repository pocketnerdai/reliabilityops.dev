---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { client } from '../../sanity/lib/client';
import { postBySlugQuery } from '../../sanity/lib/queries';

const { slug } = Astro.params;

// Simple test - just fetch and display raw data
let post;
let error;

try {
  post = await client.fetch(postBySlugQuery, { slug });
} catch (e) {
  error = e.message;
}
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title="Blog Post Debug" description="Debug page" />
  </head>
  <body>
    <Header />
    <main class="min-h-screen bg-slate-900 pt-20">
      <div class="container mx-auto px-4 py-12">
        <h1 class="text-3xl font-bold text-white mb-8">Debug: Blog Post Data</h1>
        
        {error ? (
          <div class="bg-red-900/50 p-4 rounded">
            <h2 class="text-red-400 font-bold">Error fetching post:</h2>
            <pre class="text-red-300">{error}</pre>
          </div>
        ) : post ? (
          <div>
            <div class="bg-slate-800 p-4 rounded mb-4">
              <h2 class="text-emerald-400 font-bold mb-2">Post found!</h2>
              <p class="text-white">Title: {post.title}</p>
              <p class="text-white">Slug: {slug}</p>
              <p class="text-white">Has body: {post.body ? 'Yes' : 'No'}</p>
              <p class="text-white">Body length: {post.body ? post.body.length : 0}</p>
            </div>
            
            <div class="bg-slate-800 p-4 rounded">
              <h3 class="text-emerald-400 font-bold mb-2">Raw post data:</h3>
              <pre class="text-slate-300 overflow-x-auto">{JSON.stringify(post, null, 2)}</pre>
            </div>
          </div>
        ) : (
          <div class="bg-yellow-900/50 p-4 rounded">
            <p class="text-yellow-400">No post found for slug: {slug}</p>
          </div>
        )}
      </div>
    </main>
    <Footer />
  </body>
</html>